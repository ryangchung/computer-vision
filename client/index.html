<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite App</title>
  </head>
  <body>
    <div class="container">
      <h1 id="verify">Website Blocked!</h1>
      <p>This site has been blocked to help you stay focused.</p>
      <button class="unblock-btn">Unblock</button>
    </div>

    <p>Select an image to check if it is productive or unproductive.</p>
    <input type="file" id="upload-input" />
    <button type="button" id="upload-btn">Upload and Check</button>

    <p id="result"></p>

    <script type="module">
      // When upload
      document.getElementById("upload-btn").addEventListener("click", async (e) => {
        e.preventDefault(); // Prevent form submission or default behavior

        console.log("Button clicked. Preventing form submission...");

        const input = document.getElementById("upload-input");
        const resultElement = document.getElementById("result");

        // Check if an image is selected
        if (input.files.length === 0) {
          console.log("No file selected.");
          resultElement.textContent = "Please select an image file.";
          return;
        }

        const formData = new FormData();
        formData.append("file", input.files[0]);

        try {
          const response = await fetch("http://127.0.0.1:8000/predict", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (data.error) {
            throw new Error(data.error);
          }

          const result = data.productive ? "Productive" : "Unproductive";
          console.log(result); // Log the result
          resultElement.textContent = `Result: ${result}`;
        } catch (error) {
          console.error("Error:", error);
          resultElement.textContent = `An error occurred: ${error.message}`;
        }
      });
    </script>
  </body>
</html>
